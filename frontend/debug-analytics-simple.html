<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Debug - Simple</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
    .debug-section { background: #2a2a2a; padding: 20px; margin: 10px 0; border-radius: 8px; }
    .error { color: #ff6b6b; }
    .success { color: #4caf50; }
    .info { color: #2196f3; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-primary { background: #4caf50; color: white; }
    .btn-secondary { background: #666; color: white; }
    pre { background: #333; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîß Analytics Debug - Simple</h1>
  
  <div class="debug-section">
    <h2>Environment Info</h2>
    <div id="envInfo"></div>
  </div>
  
  <div class="debug-section">
    <h2>API Tests</h2>
    <button class="btn-primary" onclick="testAllAPIs()">Test All APIs</button>
    <button class="btn-secondary" onclick="clearResults()">Clear Results</button>
    <div id="results"></div>
  </div>
  
  <div class="debug-section">
    <h2>Chart.js Test</h2>
    <button class="btn-primary" onclick="testChartJS()">Test Chart.js</button>
    <canvas id="testChart" width="400" height="200" style="background: white; margin: 10px 0;"></canvas>
    <div id="chartResult"></div>
  </div>

  <script>
    // Get API base URL
    function getApiBaseUrl() {
      const isDevelopment = window.location.hostname === 'localhost' && window.location.port !== '';
      const isLivereload = window.location.port === '8080' || window.location.port === '3000';
      
      if (isDevelopment && isLivereload) {
        const apiPort = window.ENV_API_PORT || '5001';
        return `http://localhost:${apiPort}`;
      }
      
      return '';
    }

    const API_BASE_URL = getApiBaseUrl();

    // Display environment info
    function displayEnvInfo() {
      const envInfo = document.getElementById('envInfo');
      envInfo.innerHTML = `
        <p><strong>Current URL:</strong> ${window.location.href}</p>
        <p><strong>API Base URL:</strong> ${API_BASE_URL}</p>
        <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
        <p><strong>Chart.js Available:</strong> ${typeof Chart !== 'undefined' ? '‚úÖ Yes' : '‚ùå No'}</p>
        <p><strong>Timestamp:</strong> ${new Date().toISOString()}</p>
      `;
    }

    // Test all APIs
    async function testAllAPIs() {
      const results = document.getElementById('results');
      results.innerHTML = '<p class="info">Testing APIs...</p>';
      
      const tests = [
        { name: 'Analytics Test', url: '/api/analytics/test' },
        { name: 'Daily Spending', url: '/api/analytics/daily-spending?days=30&dayOffset=0' },
        { name: 'Category Breakdown', url: '/api/analytics/category-breakdown?days=30&dayOffset=0' },
        { name: 'Heatmap', url: '/api/analytics/weekly-heatmap?days=30&dayOffset=0' },
        { name: 'Summary', url: '/api/summary' }
      ];
      
      let html = '';
      
      for (const test of tests) {
        try {
          const response = await fetch(`${API_BASE_URL}${test.url}`, {
            credentials: 'include'
          });
          
          if (response.ok) {
            const data = await response.json();
            html += `<div class="success">‚úÖ ${test.name}: OK</div>`;
            html += `<pre>${JSON.stringify(data, null, 2).substring(0, 200)}...</pre>`;
          } else {
            const errorText = await response.text();
            html += `<div class="error">‚ùå ${test.name}: ${response.status} ${response.statusText}</div>`;
            html += `<pre>${errorText}</pre>`;
          }
        } catch (error) {
          html += `<div class="error">‚ùå ${test.name}: ${error.message}</div>`;
        }
      }
      
      results.innerHTML = html;
    }

    // Test Chart.js
    function testChartJS() {
      const chartResult = document.getElementById('chartResult');
      
      if (typeof Chart === 'undefined') {
        chartResult.innerHTML = '<div class="error">‚ùå Chart.js is not loaded</div>';
        return;
      }
      
      try {
        const ctx = document.getElementById('testChart').getContext('2d');
        const testChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
            datasets: [{
              label: 'Test Data',
              data: [12, 19, 3, 5, 2],
              borderColor: 'rgb(75, 192, 192)',
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'Chart.js Test Chart'
              }
            }
          }
        });
        
        chartResult.innerHTML = '<div class="success">‚úÖ Chart.js is working correctly</div>';
      } catch (error) {
        chartResult.innerHTML = `<div class="error">‚ùå Chart.js error: ${error.message}</div>`;
      }
    }

    // Clear results
    function clearResults() {
      document.getElementById('results').innerHTML = '';
      document.getElementById('chartResult').innerHTML = '';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      displayEnvInfo();
    });
  </script>
</body>
</html>
