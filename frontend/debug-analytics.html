<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Debug - Sprout Budget</title>
  <link rel="stylesheet" href="style.css?v=4.5">
  <style>
    .debug-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      font-family: 'Inter', sans-serif;
    }
    .debug-section {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #333;
    }
    .debug-section h2 {
      color: #4CAF50;
      margin-top: 0;
    }
    .test-button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #45a049;
    }
    .result-box {
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 15px;
      margin-top: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    .success { color: #4CAF50; }
    .error { color: #FF6B6B; }
    .info { color: #2196F3; }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>üîß Analytics Debug Tool</h1>
    
    <div class="debug-section">
      <h2>Environment Info</h2>
      <div id="envInfo" class="result-box"></div>
    </div>
    
    <div class="debug-section">
      <h2>API Tests</h2>
      <button class="test-button" onclick="testAnalyticsAPI()">Test Analytics API</button>
      <button class="test-button" onclick="testDailySpending()">Test Daily Spending</button>
      <button class="test-button" onclick="testCategoryBreakdown()">Test Category Breakdown</button>
      <button class="test-button" onclick="testHeatmap()">Test Heatmap</button>
      <div id="apiResults" class="result-box"></div>
    </div>
    
    <div class="debug-section">
      <h2>Authentication Test</h2>
      <button class="test-button" onclick="testAuth()">Test Authentication</button>
      <div id="authResults" class="result-box"></div>
    </div>
  </div>

  <script>
    // Get API base URL
    function getApiBaseUrl() {
      const isDevelopment = window.location.hostname === 'localhost' && window.location.port !== '';
      const isLivereload = window.location.port === '8080' || window.location.port === '3000';
      
      if (isDevelopment && isLivereload) {
        const apiPort = window.ENV_API_PORT || '5001';
        return `http://localhost:${apiPort}`;
      }
      
      return '';
    }

    const API_BASE_URL = getApiBaseUrl();

    // Display environment info
    function displayEnvInfo() {
      const envInfo = document.getElementById('envInfo');
      envInfo.innerHTML = `
Current URL: ${window.location.href}
API Base URL: ${API_BASE_URL}
User Agent: ${navigator.userAgent}
Timestamp: ${new Date().toISOString()}
      `;
    }

    // Test analytics API
    async function testAnalyticsAPI() {
      const results = document.getElementById('apiResults');
      results.innerHTML = 'Testing analytics API...\n';
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/analytics/test`, {
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          results.innerHTML = `<span class="success">‚úÖ Analytics API Test Successful</span>\n${JSON.stringify(result, null, 2)}`;
        } else {
          results.innerHTML = `<span class="error">‚ùå Analytics API Test Failed (${response.status})</span>\n${JSON.stringify(result, null, 2)}`;
        }
      } catch (error) {
        results.innerHTML = `<span class="error">‚ùå Analytics API Test Error</span>\n${error.message}`;
      }
    }

    // Test daily spending
    async function testDailySpending() {
      const results = document.getElementById('apiResults');
      results.innerHTML = 'Testing daily spending API...\n';
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/analytics/daily-spending?days=30&dayOffset=0`, {
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          results.innerHTML = `<span class="success">‚úÖ Daily Spending API Test Successful</span>\nData points: ${result.data ? result.data.length : 0}\n${JSON.stringify(result, null, 2)}`;
        } else {
          results.innerHTML = `<span class="error">‚ùå Daily Spending API Test Failed (${response.status})</span>\n${JSON.stringify(result, null, 2)}`;
        }
      } catch (error) {
        results.innerHTML = `<span class="error">‚ùå Daily Spending API Test Error</span>\n${error.message}`;
      }
    }

    // Test category breakdown
    async function testCategoryBreakdown() {
      const results = document.getElementById('apiResults');
      results.innerHTML = 'Testing category breakdown API...\n';
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/analytics/category-breakdown?days=30&dayOffset=0`, {
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          results.innerHTML = `<span class="success">‚úÖ Category Breakdown API Test Successful</span>\nCategories: ${result.data ? result.data.length : 0}\n${JSON.stringify(result, null, 2)}`;
        } else {
          results.innerHTML = `<span class="error">‚ùå Category Breakdown API Test Failed (${response.status})</span>\n${JSON.stringify(result, null, 2)}`;
        }
      } catch (error) {
        results.innerHTML = `<span class="error">‚ùå Category Breakdown API Test Error</span>\n${error.message}`;
      }
    }

    // Test heatmap
    async function testHeatmap() {
      const results = document.getElementById('apiResults');
      results.innerHTML = 'Testing heatmap API...\n';
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/analytics/weekly-heatmap?days=30&dayOffset=0`, {
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          results.innerHTML = `<span class="success">‚úÖ Heatmap API Test Successful</span>\nWeeks: ${result.data ? result.data.length : 0}\n${JSON.stringify(result, null, 2)}`;
        } else {
          results.innerHTML = `<span class="error">‚ùå Heatmap API Test Failed (${response.status})</span>\n${JSON.stringify(result, null, 2)}`;
        }
      } catch (error) {
        results.innerHTML = `<span class="error">‚ùå Heatmap API Test Error</span>\n${error.message}`;
      }
    }

    // Test authentication
    async function testAuth() {
      const results = document.getElementById('authResults');
      results.innerHTML = 'Testing authentication...\n';
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/summary`, {
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          results.innerHTML = `<span class="success">‚úÖ Authentication Test Successful</span>\n${JSON.stringify(result, null, 2)}`;
        } else {
          results.innerHTML = `<span class="error">‚ùå Authentication Test Failed (${response.status})</span>\n${JSON.stringify(result, null, 2)}`;
        }
      } catch (error) {
        results.innerHTML = `<span class="error">‚ùå Authentication Test Error</span>\n${error.message}`;
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      displayEnvInfo();
    });
  </script>
</body>
</html>
